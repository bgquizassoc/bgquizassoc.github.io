<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1234 | –¶–∏—Ñ—Ä–æ–º–∞–Ω–∏—è</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:#00264d;
  color:#fff;
  max-width:900px;
  margin:0 auto;
  padding:20px;
  text-align:center;
}
h1{
  color:#ffd100;
  text-shadow:0 0 10px #ffcc00;
  margin-bottom:20px;
}
#start-screen,#quiz{
  background:rgba(255,255,255,0.06);
  padding:25px;
  border-radius:16px;
  max-width:600px;
  margin:0 auto;
}
input{
  padding:12px;
  font-size:1.2em;
  border-radius:8px;
  border:none;
  width:80%;
  text-align:center;
}
button{
  margin-top:15px;
  padding:12px 22px;
  font-size:1.1em;
  border-radius:8px;
  border:none;
  background:#ffd100;
  font-weight:bold;
  cursor:pointer;
}
button:hover{background:#ffcc33}
#timer{
  font-size:2.4em;
  margin:15px 0;
  color:#ffeb3b;
  text-shadow:0 0 12px #ffcc00;
}
#timer.warning{
  color:#ff4c4c;
  text-shadow:0 0 12px #ff4c4c;
}
#question{
  font-size:1.5em;
  margin:20px 0;
}
#status{
  margin-top:15px;
  font-weight:bold;
}
#score{
  margin-top:10px;
  color:#ffd100;
  font-size:1.2em;
}
</style>
</head>

<body>

<h1>1234<br>–¶–∏—Ñ—Ä–æ–º–∞–Ω–∏—è</h1>

<div id="start-screen">
  <p>–í—ä–≤–µ–¥–∏ –∏–º–µ:</p><br>
  <input id="player-name" placeholder="–ò–º–µ"><br>
  <button id="start-btn">–ó–∞–ø–æ—á–Ω–∏</button>
</div>

<div id="quiz" style="display:none;">
  <div id="timer">20</div>
  <div id="question"></div>

  <input id="answer-input" type="number" placeholder="–í—ä–≤–µ–¥–∏ —á–∏—Å–ª–æ"><br>
  <button id="submit-btn">–û—Ç–≥–æ–≤–æ—Ä–∏</button>

  <div id="status"></div>
  <div id="score"></div>
</div>

<script>
(async function(){

/* DOM */
const startScreen=document.getElementById("start-screen");
const quiz=document.getElementById("quiz");
const startBtn=document.getElementById("start-btn");
const nameInput=document.getElementById("player-name");
const timerDiv=document.getElementById("timer");
const qText=document.getElementById("question");
const ansInput=document.getElementById("answer-input");
const submitBtn=document.getElementById("submit-btn");
const statusDiv=document.getElementById("status");
const scoreDiv=document.getElementById("score");

/* STATE */
let allQuestions=[];
let questions=[];
let idx=0;
let score=0;
let timer;
let timeLeft=20;

/* LOAD JSON */
try{
  const res=await fetch("questions.json");
  allQuestions=await res.json();
}catch(e){
  qText.textContent="–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ questions.json";
  return;
}

/* RANDOM 20 */
function pickRandom(n){
  return [...allQuestions].sort(()=>Math.random()-0.5).slice(0,n);
}

/* TIMER */
function startTimer(){
  clearInterval(timer);
  timeLeft=20;
  timerDiv.textContent=timeLeft;
  timerDiv.classList.remove("warning");

  timer=setInterval(()=>{
    timeLeft--;
    timerDiv.textContent=timeLeft;
    if(timeLeft<=5) timerDiv.classList.add("warning");
    if(timeLeft<=0){
      clearInterval(timer);
      submitAnswer(true);
    }
  },1000);
}

/* POINTS ‚Äì –î–ò–ê–ü–ê–ó–û–ù–ò */
function calculatePoints(diff,q){
  if(diff===0) return 10;
  if(q.t1!=null && diff<=q.t1) return 5;
  if(q.t2!=null && diff<=q.t2) return 3;
  if(q.t3!=null && diff<=q.t3) return 1;
  return 0;
}

/* RENDER */
function renderQuestion(){
  const q=questions[idx];
  qText.textContent=`${idx+1}. ${q.question}`;
  ansInput.value="";
  statusDiv.textContent="";
  scoreDiv.textContent=`–¢–æ—á–∫–∏: ${score}`;
  startTimer();
}

/* SUBMIT */
function submitAnswer(timeout=false){
  clearInterval(timer);

  const q=questions[idx];
  const correct=q.answer;
  const user=timeout?null:Number(ansInput.value);
  const diff=user===null?999:Math.abs(user-correct);
  const pts=calculatePoints(diff,q);
  score+=pts;

  if(timeout){
    statusDiv.textContent=`‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ! –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä: ${correct}`;
  }else if(pts>0){
    statusDiv.textContent=`‚úÖ ${pts} —Ç–æ—á–∫–∏ (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ ${diff})`;
  }else{
    statusDiv.textContent=`‚ùå 0 —Ç–æ—á–∫–∏. –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä: ${correct}`;
  }

  scoreDiv.textContent=`–¢–æ—á–∫–∏: ${score}`;

  setTimeout(()=>{
    idx++;
    if(idx>=questions.length){
      qText.innerHTML=`üèÅ –ö—Ä–∞–π!<br>–†–µ–∑—É–ª—Ç–∞—Ç: <b>${score}</b> —Ç–æ—á–∫–∏`;
      timerDiv.textContent="";
      ansInput.style.display="none";
      submitBtn.style.display="none";
    }else{
      renderQuestion();
    }
  },1500);
}

/* EVENTS */
submitBtn.onclick=()=>submitAnswer(false);

startBtn.onclick=()=>{
  if(!nameInput.value.trim()) return;
  startScreen.style.display="none";
  quiz.style.display="block";
  questions=pickRandom(20);
  idx=0;
  score=0;
  renderQuestion();
};

})();
</script>

</body>
</html>
