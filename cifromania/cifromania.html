<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üî¢ –¶–∏—Ñ—Ä–æ–º–∞–Ω–∏—è</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #00264d;
  color: #fff;
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
}

h1 {
  color: #ffd100;
  margin-bottom: 20px;
}

.card {
  background: rgba(255,255,255,0.06);
  padding: 20px;
  border-radius: 16px;
  max-width: 600px;
  margin: 0 auto;
}

input {
  padding: 12px;
  font-size: 1.2em;
  border-radius: 8px;
  border: none;
  width: 80%;
  text-align: center;
}

button {
  margin-top: 15px;
  padding: 12px 24px;
  font-size: 1.1em;
  border-radius: 8px;
  border: none;
  background: #ffd100;
  font-weight: bold;
  cursor: pointer;
}

#timer {
  font-size: 2.4em;
  margin: 15px 0;
  color: #ffeb3b;
  font-weight: bold;
}

#timer.danger {
  color: #ff5252;
}

#question {
  font-size: 1.4em;
  margin: 20px 0;
}

#feedback {
  margin-top: 15px;
  font-size: 1.1em;
}

#score {
  margin-top: 10px;
  font-size: 1.2em;
  color: #ffd100;
}
</style>
</head>

<body>

<h1>1234<br>–¶–∏—Ñ—Ä–æ–º–∞–Ω–∏—è</h1>

<div id="start-screen" class="card">
  <p>–í—ä–≤–µ–¥–∏ –∏–º–µ:</p>
  <input id="playerName" placeholder="–ò–º–µ">
  <br>
  <button id="startBtn">–ó–∞–ø–æ—á–Ω–∏</button>
</div>

<div id="game" class="card" style="display:none;">
  <div id="timer">20</div>
  <div id="question"></div>

  <input type="number" id="answerInput" placeholder="–í—ä–≤–µ–¥–∏ —á–∏—Å–ª–æ">
  <br>
  <button id="submitBtn">–û—Ç–≥–æ–≤–æ—Ä–∏</button>

  <div id="feedback"></div>
  <div id="score">–¢–æ—á–∫–∏: 0</div>
</div>

<script>

(async function(){

/* DOM */
const startScreen = document.getElementById("start-screen");
const quiz = document.getElementById("quiz");
const startBtn = document.getElementById("start-btn");
const nameInput = document.getElementById("player-name");
const timerDiv = document.getElementById("timer");
const qText = document.getElementById("question");
const ansInput = document.getElementById("answer-input");
const submitBtn = document.getElementById("submit-btn");
const statusDiv = document.getElementById("status");
const scoreDiv = document.getElementById("score");

/* STATE */
let allQuestions = [];
let questions = [];
let idx = 0;
let score = 0;
let timer;
let timeLeft = 20;

/* LOAD JSON */
const res = await fetch("questions.json");
allQuestions = await res.json();

/* RANDOM 20 */
function pickRandom(n){
  return [...allQuestions].sort(()=>Math.random()-0.5).slice(0,n);
}

/* TIMER */
function startTimer(){
  clearInterval(timer);
  timeLeft = 20;
  timerDiv.textContent = timeLeft;
  timerDiv.classList.remove("warning");

  timer = setInterval(()=>{
    timeLeft--;
    timerDiv.textContent = timeLeft;
    if(timeLeft <= 5) timerDiv.classList.add("warning");
    if(timeLeft <= 0){
      clearInterval(timer);
      submitAnswer(true);
    }
  },1000);
}

/* POINTS ‚Äì –î–û –¥–∏–∞–ø–∞–∑–æ–Ω */
function calcPoints(diff, q){
  const t1 = Number(q.t1);
  const t2 = Number(q.t2);
  const t3 = Number(q.t3);

  if (diff === 0) return 10;
  if (!isNaN(t1) && diff <= t1) return 5;
  if (!isNaN(t2) && diff <= t2) return 3;
  if (!isNaN(t3) && diff <= t3) return 1;
  return 0;
}

/* RENDER */
function renderQuestion(){
  const q = questions[idx];
  qText.textContent = `${idx+1}. ${q.question}`;
  ansInput.value = "";
  ansInput.focus();
  statusDiv.textContent = "";
  scoreDiv.textContent = `–¢–æ—á–∫–∏: ${score}`;
  startTimer();
}

/* SUBMIT */
function submitAnswer(timeout=false){
  clearInterval(timer);

  const q = questions[idx];
  const correct = Number(q.answer);
  const user = timeout ? null : Number(ansInput.value);

  let diff = user === null || isNaN(user)
    ? Infinity
    : Math.abs(user - correct);

  const pts = calcPoints(diff, q);
  score += pts;

  if(timeout){
    statusDiv.textContent =
      `‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ! –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä: ${correct}`;
  } else {
    statusDiv.textContent =
      `–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: ${diff} ‚Üí ${pts} —Ç–æ—á–∫–∏ (–≤–µ—Ä–µ–Ω: ${correct})`;
  }

  scoreDiv.textContent = `–¢–æ—á–∫–∏: ${score}`;

  setTimeout(()=>{
    idx++;
    if(idx >= questions.length){
      qText.innerHTML = `üèÅ –ö—Ä–∞–π!<br>–û–±—â–æ —Ç–æ—á–∫–∏: <b>${score}</b>`;
      timerDiv.textContent = "";
      ansInput.style.display = "none";
      submitBtn.style.display = "none";
    } else {
      renderQuestion();
    }
  }, 1500);
}

/* EVENTS */
submitBtn.onclick = () => submitAnswer(false);

ansInput.addEventListener("keydown", e => {
  if (e.key === "Enter") submitAnswer(false);
});

startBtn.onclick = ()=>{
  if(!nameInput.value.trim()) return;
  startScreen.style.display = "none";
  quiz.style.display = "block";
  questions = pickRandom(20);
  idx = 0;
  score = 0;
  renderQuestion();
};

})();
</script>

</body>
</html>
